{
  "version": 3,
  "sources": ["../../fun-hooks/eval/index.js"],
  "sourcesContent": ["/*\n* @license MIT\n* Fun Hooks v1.0.4\n* (c) @snapwich\n*/\ncreate.SYNC = 1;\ncreate.ASYNC = 2;\ncreate.QUEUE = 4;\n\nvar packageName = \"fun-hooks\";\n\nvar defaults = Object.freeze({\n  ready: 0\n});\n\nvar hookableMap = new WeakMap();\n\nfunction rest(args, skip) {\n  return Array.prototype.slice.call(args, skip);\n}\n\nfunction runAll(queue) {\n  var queued;\n  // eslint-disable-next-line no-cond-assign\n  while ((queued = queue.shift())) {\n    queued();\n  }\n}\n\nfunction create(config) {\n  var hooks = {};\n  var postReady = [];\n\n  config = Object.assign({}, defaults, config);\n\n  function dispatch(arg1, arg2) {\n    if (typeof arg1 === \"function\") {\n      return hookFn.call(null, \"sync\", arg1, arg2);\n    } else if (typeof arg1 === \"string\" && typeof arg2 === \"function\") {\n      return hookFn.apply(null, arguments);\n    } else if (typeof arg1 === \"object\") {\n      return hookObj.apply(null, arguments);\n    }\n  }\n\n  var ready;\n  if (config.ready) {\n    dispatch.ready = function() {\n      ready = true;\n      runAll(postReady);\n    };\n  } else {\n    ready = true;\n  }\n\n  function hookObj(obj, props, objName) {\n    var walk = true;\n    if (typeof props === \"undefined\") {\n      props = Object.getOwnPropertyNames(obj).filter(prop => !prop.match(/^_/));\n      walk = false;\n    }\n    var objHooks = {};\n    var doNotHook = [\"constructor\"];\n    do {\n      props.forEach(function(prop) {\n        var parts = prop.match(/(?:(sync|async):)?(.+)/);\n        var type = parts[1] || \"sync\";\n        var name = parts[2];\n        if (\n          !objHooks[name] &&\n          typeof obj[name] === \"function\" &&\n          !(doNotHook.indexOf(name) !== -1)\n        ) {\n          var fn = obj[name];\n          objHooks[name] = obj[name] = hookFn(\n            type,\n            fn,\n            objName ? [objName, name] : undefined\n          );\n        }\n      });\n      obj = Object.getPrototypeOf(obj);\n    } while (walk && obj);\n    return objHooks;\n  }\n\n  /**\n   * Navigates a string path to return a hookable function.  If not found, creates a placeholder for hooks.\n   * @param {(Array<string> | string)} path\n   */\n  function get(path) {\n    var parts = Array.isArray(path) ? path : path.split(\".\");\n    return parts.reduce(function(memo, part, i) {\n      var item = memo[part];\n      var installed = false;\n      if (item) {\n        return item;\n      } else if (i === parts.length - 1) {\n        if (!ready) {\n          postReady.push(function() {\n            if (!installed) {\n              // eslint-disable-next-line no-console\n              console.warn(\n                packageName +\n                  \": referenced '\" +\n                  path +\n                  \"' but it was never created\"\n              );\n            }\n          });\n        }\n        return (memo[part] = newHookable(function(fn) {\n          memo[part] = fn;\n          installed = true;\n        }));\n      }\n      return (memo[part] = {});\n    }, hooks);\n  }\n\n  function newHookable(onInstall) {\n    var before = [];\n    var after = [];\n    var generateTrap = function() {};\n\n    var api = {\n      before: function(hook, priority) {\n        return add.call(this, before, \"before\", hook, priority);\n      },\n      after: function(hook, priority) {\n        return add.call(this, after, \"after\", hook, priority);\n      },\n      getHooks: function(match) {\n        var hooks = before.concat(after);\n        if (typeof match === \"object\") {\n          hooks = hooks.filter(function(entry) {\n            return Object.keys(match).every(function(prop) {\n              return entry[prop] === match[prop];\n            });\n          });\n        }\n        try {\n          Object.assign(hooks, {\n            remove: function() {\n              hooks.forEach(function(entry) {\n                entry.remove();\n              });\n              return this;\n            }\n          });\n        } catch (e) {\n          console.error(\n            \"error adding `remove` to array, did you modify Array.prototype?\"\n          );\n        }\n        return hooks;\n      },\n      removeAll: function() {\n        return this.getHooks().remove();\n      }\n    };\n\n    var meta = {\n      install: function(type, fn, generate) {\n        this.type = type;\n        generateTrap = generate;\n        generate(before, after);\n        onInstall && onInstall(fn);\n      }\n    };\n\n    // store meta data related to hookable. use `api.after` since `api` reference is not available on our proxy.\n    hookableMap.set(api.after, meta);\n\n    return api;\n\n    function add(store, type, hook, priority) {\n      var entry = {\n        hook: hook,\n        type: type,\n        priority: priority || 10,\n        remove: function() {\n          var index = store.indexOf(entry);\n          if (index !== -1) {\n            store.splice(index, 1);\n            generateTrap(before, after);\n          }\n        }\n      };\n      store.push(entry);\n      store.sort(function(a, b) {\n        return b.priority - a.priority;\n      });\n      generateTrap(before, after);\n      return this;\n    }\n  }\n\n  function hookFn(type, fn, name) {\n    // check if function has already been wrapped\n    var meta = fn.after && hookableMap.get(fn.after);\n    if (meta) {\n      if (meta.type !== type) {\n        throw packageName + \": recreated hookable with different type\";\n      } else {\n        return fn;\n      }\n    }\n\n    var hookable = name ? get(name) : newHookable();\n\n    var trap;\n\n    var handlers = {\n      get: function(target, prop) {\n        return hookable[prop] || Reflect.get.apply(Reflect, arguments);\n      }\n    };\n\n    if (!ready) {\n      postReady.push(setTrap);\n    }\n\n    var hookedFn = new Proxy(fn, handlers);\n\n    hookableMap.get(hookedFn.after).install(type, hookedFn, generateTrap);\n\n    return hookedFn;\n\n    function generateTrap(before, after) {\n      if (before.length || after.length) {\n        var code;\n        if (type === \"sync\") {\n          var beforeCode =\n            \"r=t.apply(h,\" + (before.length ? \"arguments\" : \"g\") + \")\";\n          var afterCode;\n          if (after.length) {\n            afterCode = chainHooks(after, \"a\", \"n(function extract(s){r=s},e)\");\n          }\n          if (before.length) {\n            beforeCode = chainHooks(\n              before,\n              \"b\",\n              \"n(function extract(){\" + beforeCode + \";\" + afterCode + \"},e)\"\n            );\n            afterCode = \"\";\n          }\n          code = [\n            \"var r,e={bail:function(a){r=a}}\",\n            beforeCode,\n            afterCode,\n            \"return r\"\n          ].join(\";\");\n        } else if (type === \"async\") {\n          code =\n            \"t.apply(h,\" +\n            (before.length\n              ? \"Array.prototype.slice.call(arguments)\" // if we're wrapped in partial, extract arguments\n              : \"g\") + // otherwise, we can just use passed in arguments\n            \".concat(\" +\n            chainHooks(after, \"a\", \"z?n(z,e):[]\") +\n            \"))\";\n          if (before.length) {\n            code = \"n(function partial(){\" + code + \"},e)\";\n          }\n          code = [\n            \"var z\",\n            'typeof g[g.length-1]===\"function\"&&(z=i.call(g.pop(),null))',\n            \"var e={bail:z}\",\n            chainHooks(before, \"b\", code)\n          ].join(\";\");\n        }\n        trap = new Function(\"i,b,a,n,t,h,g\", code).bind(\n          null,\n          Function.prototype.bind,\n          before,\n          after,\n          Object.assign\n        );\n      } else {\n        trap = undefined;\n      }\n      setTrap();\n\n      function chainHooks(hooks, name, code) {\n        for (var i = hooks.length; i-- > 0; ) {\n          if (i === 0 && !(type === \"async\" && name === \"a\")) {\n            code =\n              name +\n              \"[\" +\n              i +\n              \"].hook.apply(h,[\" +\n              code +\n              (name === \"b\" ? \"].concat(g))\" : \",r])\");\n          } else {\n            code = \"i.call(\" + name + \"[\" + i + \"].hook, h,\" + code + \")\";\n            if (!(type === \"async\" && name === \"a\" && i === 0)) {\n              code = \"n(\" + code + \",e)\";\n            }\n          }\n        }\n        return code;\n      }\n    }\n\n    function setTrap() {\n      if (\n        ready ||\n        (type === \"sync\" && !(config.ready & create.SYNC)) ||\n        (type === \"async\" && !(config.ready & create.ASYNC))\n      ) {\n        handlers.apply = trap;\n      } else if (type === \"sync\" || !(config.ready & create.QUEUE)) {\n        handlers.apply = function() {\n          throw packageName + \": hooked function not ready\";\n        };\n      } else {\n        handlers.apply = function() {\n          var args = arguments;\n          postReady.push(function() {\n            hookedFn.apply(args[1], args[2]);\n          });\n        };\n      }\n    }\n  }\n\n  dispatch.get = get;\n  return dispatch;\n}\n\n/* global module */\nmodule.exports = create;\n"],
  "mappings": "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",
  "names": ["hooks", "name", "code"]
}
